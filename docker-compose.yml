version: "3.8"
services:
  e2e:
    build:
      context: .
      args:
        BASE_IMAGE: mcr.microsoft.com/playwright:v1.28.1-focal
        PROJECT_NAME: ${PROJECT_NAME:-web}
        NEXT_PUBLIC_CHAIN_TYPE: ${NEXT_PUBLIC_CHAIN_TYPE:-mainnet}
        TURBO_TEAM: ${TURBO_TEAM:-}
        TURBO_TOKEN: ${TURBO_TOKEN:-}
      target: e2e
    platform: linux/amd64
    ipc: host
    cap_add:
      - "SYS_ADMIN"
    init: true
    volumes:
      - yarn-cache:/root/.yarn/berry/cache:rw
      - ${PWD}/playwright-report:/app/playwright-report:rw
  web:
    build:
      context: .
      args:
        PROJECT_NAME: ${PROJECT_NAME:-web}
        NEXT_PUBLIC_CHAIN_TYPE: ${NEXT_PUBLIC_CHAIN_TYPE:-mainnet}
        TURBO_TEAM: ${TURBO_TEAM:-}
        TURBO_TOKEN: ${TURBO_TOKEN:-}
        PORT: ${PORT:-3000}
        NEXT_PUBLIC_SENTRY_DSN: ${NEXT_PUBLIC_SENTRY_DSN:-}
        SENTRY_AUTH_TOKEN: ${SENTRY_AUTH_TOKEN:-}
      target: web
    restart: always
    platform: linux/amd64
    volumes:
      - yarn-cache:/root/.yarn/berry/cache:rw
    ports:
      - ${PORT:-3000}:${PORT:-3000}
    networks:
      - app_network
# Define a network, which allows containers to communicate
# with each other, by using their container name as a hostname
networks:
  app_network:
volumes:
  yarn-cache:
